(this.webpackJsonpmicrobots=this.webpackJsonpmicrobots||[]).push([[0],{45:function(t,n,e){"use strict";e.r(n);var r={};e.r(r),e.d(r,"newVec3",(function(){return w})),e.d(r,"clone",(function(){return y})),e.d(r,"add",(function(){return S})),e.d(r,"sub",(function(){return M})),e.d(r,"multiplyScalar",(function(){return A})),e.d(r,"divideScalar",(function(){return E})),e.d(r,"dot",(function(){return k})),e.d(r,"length",(function(){return C})),e.d(r,"normalize",(function(){return I}));var o={};e.r(o),e.d(o,"newBot",(function(){return W})),e.d(o,"setPos",(function(){return D})),e.d(o,"setWeight",(function(){return F})),e.d(o,"setFixed",(function(){return G})),e.d(o,"average",(function(){return P}));var u={};e.r(u),e.d(u,"newWorld",(function(){return U})),e.d(u,"setBots",(function(){return X})),e.d(u,"setSlack",(function(){return Q})),e.d(u,"edgeStrength",(function(){return $})),e.d(u,"edgeStrengthGround",(function(){return _})),e.d(u,"stiffness",(function(){return tt})),e.d(u,"stiffnessGround",(function(){return nt})),e.d(u,"stiffnessDerivative",(function(){return et})),e.d(u,"stiffnessPair",(function(){return rt})),e.d(u,"stiffnessPairDerivative",(function(){return ot})),e.d(u,"stiffnessMatrix",(function(){return ut})),e.d(u,"forceMatrix",(function(){return at})),e.d(u,"displacement",(function(){return ct})),e.d(u,"resolveCollisionStep",(function(){return it})),e.d(u,"resolveCollision",(function(){return st})),e.d(u,"gradient",(function(){return ft}));var a={};e.r(a),e.d(a,"createAnimation",(function(){return pt}));var c=e(3),i=e(0),s=e.n(i),f=e(11),b=e.n(f),l=e(5),d=e(6),p=e(2),h=e(27),j=e(60),v=e(62),m=e(63),g=e(64),O=e(65),x=e(33),w=function(t,n,e){return[t,n,e]},y=function(t){return[t[0],t[1],t[2]]},S=function(t,n){return[t[0]+n[0],t[1]+n[1],t[2]+n[2]]},M=function(t,n){return[t[0]-n[0],t[1]-n[1],t[2]-n[2]]},A=function(t,n){return[t[0]*n,t[1]*n,t[2]*n]},E=function(t,n){return[t[0]/n,t[1]/n,t[2]/n]},k=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]},C=function(t){return Math.sqrt(k(t,t))},I=function(t){return E(t,C(t))},B=function(t,n,e){return[t,n,e]},V=function(t,n){return[S(t[0],n[0]),S(t[1],n[1]),S(t[2],n[2])]},q=function(t,n){return[A(t[0],n),A(t[1],n),A(t[2],n)]},N=function(t,n){return[k(t[0],n),k(t[1],n),k(t[2],n)]},W=function(){return{pos:w(0,0,0),weight:1,fixed:!1}},D=function(t){return function(n){return n.pos=t,n}},F=function(t){return function(n){return n.weight=t,n}},G=function(t){return function(n){return n.fixed=t,n}},P=function(t,n){var e=W();return e.pos=E(S(t.pos,n.pos),2),e.weight=(t.weight+n.weight)/2,e.fixed=t.fixed||n.fixed,e},T=function(t,n){t.length!==n.length&&function(){throw new Error("Vectors need to be the same length")}();for(var e=0,r=0;r<t.length;++r)e+=t[r]*n[r];return e},R=function(t,n){return B(w(t[0]*n[0],t[0]*n[1],t[0]*n[2]),w(t[1]*n[0],t[1]*n[1],t[1]*n[2]),w(t[2]*n[0],t[2]*n[1],t[2]*n[2]))},z=function(t,n){for(var e=0,r=0;r<t.length;++r)e+=t[r]*n[r];return e},J=function(t,n,e){return t.map((function(t,r){return t+n[r]*e}))},H=function(t,n){for(var e=n.map((function(){return 0})),r=0;r<t.length;++r){var o=t[r][0],u=t[r][1],a=t[r][2];e[o]+=a*n[u]}return e},L=function(t,n){var e=function(t,n){n=n.map((function(t){return t}));for(var e=Object(l.a)(Array(n.length/3)).map((function(){return 0})),r=0;r<t.length;++r){var o=Object(d.a)(t[r],3),u=o[0],a=o[1],c=o[2];Math.floor(u/3)===Math.floor(a/3)&&(e[Math.floor(u/3)]+=c)}e.map((function(t,n){return e[n]=Math.sqrt(3/t)}));for(var i=0;i<t.length;++i)t[i][2]*=e[Math.floor(t[i][0]/3)];for(var s=0;s<n.length;++s)n[s]*=e[Math.floor(s/3)];return[t,n]}(t,n);return function(t,n){for(var e=n.map((function(){return 0})),r=J(n,H(t,e),-1),o=r.map((function(t){return t})),u=z(r,r),a=0;a<10;++a){var c=H(t,o),i=u/z(o,c);e=J(e,o,i),r=J(r,c,-i);var s=z(r,r);o=J(r,o,s/u),u=s}return e}(e[0],e[1])},U=function(){return{bots:[]}},X=function(t){return function(n){return n.bots=t,n}},Y=1.5,K=2,Q=function(t){K=t},Z=.1,$=function(t){return t<Y-K/2?1:t>Y+K/2?0:2*(t+K-Y)*Math.pow(Y+K/2-t,2)/Math.pow(K,3)},_=function(t){return $(t)+1e-4},tt=function(t){var n=C(t);return t=A(t,Math.sqrt($(n))/n),R(t,t)},nt=function(t){return q(R(t,t),_(C(t))/k(t,t))},et=function(t){return function(n){var e=1e-5,r=n[t],o=y(n);o[t]=r+e;var u=y(n);u[t]=r-e;var a,c,i=tt(o),s=tt(u);return q((c=s,[M((a=i)[0],c[0]),M(a[1],c[1]),M(a[2],c[2])]),1/2e-5)}},rt=function(t,n){var e=M(n.pos,t.pos);return tt(e)},ot=function(t){return function(n){return function(e,r){if(e!==t&&r!==t)return B(w(0,0,0),w(0,0,0),w(0,0,0));var o=et(n)(M(r.pos,e.pos));return e===t?o:q(o,-1)}}},ut=function(t){for(var n=[],e=0;e<t.bots.length;++e)for(var r=q(nt(w(t.bots[e].pos[1]+.5,0,0)),Z),o=nt(w(0,t.bots[e].pos[1]+.5,0)),u=q(nt(w(0,0,t.bots[e].pos[1]+.5)),Z),a=V(V(r,o),u),c=0;c<3;++c)for(var i=0;i<3;++i)n.push([3*e+c,3*e+i,a[c][i]]);for(var s=0;s<t.bots.length;++s)for(var f=0;f<t.bots.length;++f)if(s!==f&&!(C(M(t.bots[s].pos,t.bots[f].pos))>Y+K/2)){for(var b=rt(t.bots[s],t.bots[f]),l=0;l<3;++l)for(var d=0;d<3;++d)n[9*s+3*l+d][2]+=b[l][d];for(var p=0;p<3;++p)for(var h=0;h<3;++h)n.push([3*s+p,3*f+h,-b[p][h]])}return n},at=function(t,n,e){return function(r){var o=Object(l.a)(Array(3*r.bots.length)).map((function(){return 0}));return r.bots.forEach((function(u,a){for(var c=0;c<3;++c){var i=(r.bots[a].pos[c]-t.bots[a].pos[c])/e,s=((n.bots[a].pos[c]-r.bots[a].pos[c])/e-i)/e;o[3*a+c]=((1===c?-1:0)-s)*u.weight}})),o}},ct=function(t,n,e){return function(r){var o=at(t,n,e)(r),u=ut(r);return L(u,o)}},it=function(t){for(var n=0;n<t.bots.length;++n)t.bots[n].fixed||(t.bots[n].pos[1]=Math.max(t.bots[n].pos[1],.5));for(var e=0;e<t.bots.length;++e)for(var r=e+1;r<t.bots.length;++r)if(!t.bots[e].fixed||!t.bots[r].fixed){var o=t.bots[e].fixed||t.bots[r].fixed,u=M(t.bots[r].pos,t.bots[e].pos),a=C(u);if(!(a>1)){var c=A(u,(1-a)/(o?1:2)/a);t.bots[e].fixed||(t.bots[e].pos=M(t.bots[e].pos,c)),t.bots[r].fixed||(t.bots[r].pos=S(t.bots[r].pos,c))}}return t},st=function(t){for(var n=t,e=0;e<10;++e)n=it(n);return n},ft=function(t,n,e){return function(r,o,u,a,c){return function(i){for(var s=Object(l.a)(Array(i.bots.length)).map((function(){return w(0,0,0)})),f=Object(l.a)(Array(i.bots.length)).map((function(){return[0,1,2].map((function(){return Object(l.a)(Array(3*i.bots.length)).map((function(){return 0}))}))})),b=0;b<i.bots.length;++b)for(var d=0;d<3;++d){for(var p=q(et(d)(w(i.bots[b].pos[1]+.5,0,0)),Z),h=et(d)(w(0,i.bots[b].pos[1]+.5,0)),j=q(et(d)(w(0,0,i.bots[b].pos[1]+.5)),Z),v=w(n[3*b],n[3*b+1],n[3*b+2]),m=N(V(V(p,h),j),v),g=0;g<3;++g)f[b][d][3*b+g]+=m[g];for(var O=b+1;O<i.bots.length;++O)if(!(C(M(i.bots[O].pos,i.bots[b].pos))>Y+K/2))for(var x=ot(i.bots[b])(d)(i.bots[b],i.bots[O]),y=N(x,M(w(n[3*O],n[3*O+1],n[3*O+2]),v)),E=0;E<3;++E)f[b][d][3*b+E]+=y[E],f[b][d][3*O+E]-=y[E],f[O][d][3*O+E]+=y[E],f[O][d][3*b+E]-=y[E]}for(var k=0;k<i.bots.length;++k)for(var I=0;I<3;++I){var B=f[k][I];s[k][I]=-T(n,B)+(-t[3*k+I]+2*n[3*k+I]-e[3*k+I])/Math.pow(c,2)*2}for(var W=0;W<i.bots.length;++W)if(!(i.bots[W].pos[1]>.5)){var D=i.bots[W].pos[1]+.5;s[W][1]+=2*(D-2)*2e3}for(var F=0;F<i.bots.length;++F)for(var G=F+1;G<i.bots.length;++G){var P=M(i.bots[G].pos,i.bots[F].pos),R=C(P);R>1||(P=A(P,2*(R-2)/R*1e3),s[F]=M(s[F],P),s[G]=S(s[G],P))}for(var z=0;z<i.bots.length;++z){var J=A(r.bots[z].pos,2),H=A(o.bots[z].pos,-8),L=A(i.bots[z].pos,12),U=A(u.bots[z].pos,-8),X=A(a.bots[z].pos,2),Q=S(S(S(S(J,H),L),U),X);s[z]=S(s[z],A(Q,1e5/Math.pow(c,4)))}return s}}},bt=function(t,n){var e=U();return e.bots=t.bots.map((function(t,e){return P(t,n.bots[e])})),e},lt=function(t,n){for(var e=t.map((function(t){return t.bots.map((function(){return w(0,0,0)}))})),r=function(r){var o=(1+r*t.length/500)*t.length/10;Q(2/o);var u=function(t,n){for(var e=Object(l.a)(Array(t.length)).map((function(){return Object(l.a)(Array(t[0].bots.length)).map((function(){return w(0,0,0)}))})),r=Object(l.a)(Array(t.length)).map((function(){return Object(l.a)(Array(3*t[0].bots.length)).map((function(){return 0}))})),o=0;o<t.length;++o){var u=t[Math.max(o-1,0)],a=t[Math.min(o+1,t.length-1)];r[o]=ct(u,a,n)(t[o])}for(var c=1;c<t.length-1;++c){var i=t[Math.max(c-2,0)],s=t[c-1],f=t[c+1],b=t[Math.min(c+2,t.length-1)];e[c]=ft(r[c-1],r[c],r[c+1])(i,s,f,b,n)(t[c])}return e}(t,n).map((function(t){return t.map((function(t){return A(t,-.02/(1e-4+C(t)))}))}));t.map((function(t,n){return t.bots.map((function(t,r){t.fixed||(e[n][r]=S(e[n][r],u[n][r]),e[n][r]=A(e[n][r],.9),t.pos=S(t.pos,e[n][r]))}))}))},o=0;o<500/t.length;++o)r(o)},dt=function(t){for(var n=Object(l.a)(Array(2*t.length-1)),e=0;e<t.length;++e)n[2*e]=t[e];for(var r=1;r<n.length-1;r+=2)n[r]=bt(n[r-1],n[r+1]);return n},pt=function(t,n,e){for(var r=[t,n],o=100,u=0;u<e;++u)o/=2,r=dt(r),lt(r,o);return r},ht=e(26),jt=function(){var t=new p.n;t.add(new p.a(16777215,.4));var n=new p.e(16777215,.4);return n.position.set(0,1,0),t.add(n),t},vt=function(t,n,e){return function(r){var o=new p.h;o.lookAt(Object(ht.a)(p.s,Object(l.a)(t)),Object(ht.a)(p.s,Object(l.a)(n)),(new p.k).up),o.multiply((new p.h).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1)),r.setRotationFromMatrix(o),r.scale.set(e,C(M(n,t)),e);var u=E(S(t,n),2);return r.position.set(u[0],u[1],u[2]),r}},mt=function(t,n,e,r){var o=new p.d(1,1,1,8,1),u=new p.i(o,new p.j({color:r}));return vt(t,n,e)(u)},gt=e(28),Ot=[{title:"Towers",data:[[[2,.5,0],[2,1.5,0],[2,2.5,0],[2,3.5,0],[2,4.5,0],[-2,.5,0],[-2,1.5,0],[-2,2.5,0],[-2,3.5,0],[-2,4.5,0],[2,5.5,0]],[[2,.5,0],[2,1.5,0],[2,2.5,0],[2,3.5,0],[2,4.5,0],[-2,.5,0],[-2,1.5,0],[-2,2.5,0],[-2,3.5,0],[-2,4.5,0],[-2,5.5,0]]]},{title:"Stack",data:[[[0,.5,0],[0,1.5,0],[0,2.5,0],[0,3.5,0],[0,4.5,0]],[[0,.5,0],[1,.5,0],[2,.5,0],[3,.5,0],[4,.5,0]]]},{title:"Cube",data:[[[-.5,.5,-.5],[.5,.5,-.5],[.5,.5,.5],[-.5,.5,.5],[-.5,1.5,-.5],[.5,1.5,-.5],[.5,1.5,.5],[-.5,1.5,.5],[-.5,2.5,-.5],[.5,2.5,-.5],[.5,2.5,.5],[-.5,2.5,.5],[-.5,3.5,-.5],[.5,3.5,-.5],[.5,3.5,.5],[-.5,3.5,.5]],[[-1.5,.5,-1.5],[-.5,.5,-1.5],[.5,.5,-1.5],[1.5,.5,-1.5],[-1.5,.5,-.5],[-.5,.5,-.5],[.5,.5,-.5],[1.5,.5,-.5],[-1.5,.5,.5],[-.5,.5,.5],[.5,.5,.5],[1.5,.5,.5],[-1.5,.5,1.5],[-.5,.5,1.5],[.5,.5,1.5],[1.5,.5,1.5]]]},{title:"Big cube",data:[Object(l.a)(Array(8)).map((function(t,n){return Object(l.a)(Array(8)).map((function(t,e){return[n-3.5,.5,e-3.5]}))})).flat(),Object(l.a)(Array(4)).map((function(t,n){return Object(l.a)(Array(4)).map((function(t,e){return Object(l.a)(Array(4)).map((function(t,r){return[n-1.5,r+.5,e-1.5]}))}))})).flat().flat()]}],xt=function(t,n){return u.setBots(Ot[t].data[n].map((function(t){return o.setPos(r.newVec3(t[0],t[1],t[2]))(o.newBot())})))(u.newWorld())},wt=new gt.a(123),yt=Object(j.a)((function(t){return{gridItem:{padding:t.spacing(2),textAlign:"center"}}})),St=function(){var t=Object(x.a)(),n=Object(d.a)(t,2),e=n[0],o=n[1],s=.55*e,f=.9*o,b=yt(),j=Object(i.useRef)(null),w=Object(i.useState)(),y=Object(d.a)(w,2),S=y[0],M=y[1],A=Object(i.useState)(),E=Object(d.a)(A,2),k=E[0],C=E[1],I=Object(i.useState)(),B=Object(d.a)(I,2),V=B[0],q=B[1],N=Object(i.useState)(0),W=Object(d.a)(N,2),D=W[0],F=W[1],G=Object(i.useState)(0),P=Object(d.a)(G,2),T=P[0],R=P[1],z=Object(i.useState)(!1),J=Object(d.a)(z,2),H=J[0],L=J[1],U=Object(i.useState)(jt()),X=Object(d.a)(U,2),Y=X[0],K=X[1],Q=Object(i.useState)([]),Z=Object(d.a)(Q,2),$=Z[0],_=Z[1],tt=Object(i.useState)([]),nt=Object(d.a)(tt,2),et=nt[0],rt=nt[1],ot=Object(i.useState)([]),ut=Object(d.a)(ot,2),at=ut[0],ct=ut[1],it=Object(i.useState)([]),st=Object(d.a)(it,2),ft=st[0],bt=st[1],lt=Object(i.useState)(u.newWorld()),dt=Object(d.a)(lt,2),pt=dt[0],ht=dt[1],gt=Object(i.useState)(u.newWorld()),St=Object(d.a)(gt,2),Mt=St[0],At=St[1],Et=function(t){ft[t].bots.map((function(t,n){var e;(e=$[n].position).set.apply(e,Object(l.a)(t.pos))})),ft[t].bots.map((function(t,n){Y.remove(et[n]);var e=u.edgeStrength(t.pos[1]+.5);e<.01||(Y.add(et[n]),vt(t.pos,r.newVec3(t.pos[0],0,t.pos[2]),.3*Math.sqrt(e))(et[n]))})),ft[t].bots.map((function(n,e){return ft[t].bots.map((function(t,o){if(!(e>=o)){Y.remove(at[e][o]);var a=u.edgeStrength(r.length(r.sub(t.pos,n.pos)));a<.01||(Y.add(at[e][o]),vt(n.pos,t.pos,.3*Math.sqrt(a))(at[e][o]))}}))}))};return Object(i.useEffect)((function(){0!==ft.length&&(_(ft[0].bots.map((function(t){return function(t,n){var e,r=new p.o(1,16,16);r.computeVertexNormals(),r.faces.forEach((function(t){return t.vertexColors=new Array(3).fill(!0).map((function(){return n}))}));var o=(new p.b).fromGeometry(r);delete o.attributes.uv;var u=new p.i(o,new p.j({color:n}));return u.geometry=o,(e=u.position).set.apply(e,Object(l.a)(t)),u.scale.set(.5,.5,.5),u}(t.pos,t.fixed?new p.c(0,0,1):new p.c(0,1,0))}))),rt(ft[0].bots.map((function(t){return mt(t.pos,r.newVec3(t.pos[0],0,t.pos[2]),1,new p.c(1,0,0))}))),ct(ft[0].bots.map((function(t){return ft[0].bots.map((function(n){return mt(t.pos,n.pos,1,new p.c(1,0,0))}))}))))}),[ft]),Object(i.useEffect)((function(){var t=jt();$.map((function(n){return t.add(n)})),et.map((function(n){return t.add(n)})),at.map((function(n,e){return n.map((function(n,r){e>=r||t.add(n)}))})),K(t)}),[$,et,at]),Object(i.useEffect)((function(){var t=j.current;if(t){var n=new p.l(75,s/f,.1,1e3);n.position.set(10,10,10),n.lookAt(0,0,0),C(n);var e=new p.t({antialias:!0});e.setClearColor("#000000"),e.setSize(s,f),t.appendChild(e.domElement),q(e);var r=new h.a(n,e.domElement);r.enableDamping=!0,r.dampingFactor=.5,M(r);var o=window.setInterval((function(){return F((function(t){return t+1}))}),1e3/30);return function(){window.clearInterval(o),t.removeChild(e.domElement)}}}),[j,s,f]),Object(i.useEffect)((function(){S&&S.update(),V&&k&&Y&&V.render(Y,k)}),[S,V,k,D,Y]),Object(i.useEffect)((function(){if(0!==$.length){var t=Math.round(.1*ft.length),n=T%(2*(ft.length+t));n<t?Et(0):(n-=t)<ft.length?Et(n):(n-=ft.length)<t?Et(ft.length-1):(n-=t,Et(ft.length-1-n))}}),[T,Y]),Object(i.useEffect)((function(){if(H){var t=setInterval((function(){return R((function(t){return t+1}))}),10);return function(){return clearInterval(t)}}}),[H]),Object(c.jsx)(c.Fragment,{children:Object(c.jsxs)(v.a,{container:!0,item:!0,xs:11,children:[Object(c.jsx)(v.a,{item:!0,xs:4,style:{height:.9*window.innerHeight,overflowX:"hidden",overflowY:"scroll"},children:Object(c.jsxs)(v.a,{container:!0,direction:"column",children:[Object(c.jsx)(v.a,{item:!0,className:b.gridItem,children:Object(c.jsx)(m.a,{children:Object(c.jsxs)(g.a,{children:[Object(c.jsx)(O.a,{children:Object(c.jsx)("b",{children:"Microbots"})}),Object(c.jsx)(O.a,{children:Object(c.jsxs)("button",{onClick:function(){return R(T+1)},children:["Time: ",T]})}),Object(c.jsx)(O.a,{children:Object(c.jsxs)("button",{onClick:function(){return L(!H)},children:["Animating: ",H?"true":"false"]})}),Object(c.jsx)(O.a,{children:Object(c.jsx)("button",{onClick:function(){return function(){var t=document.getElementsByTagName("canvas")[0].toDataURL("image/png"),n=document.createElement("a");n.href=t.replace(/^data:image\/[^;]/,"data:application/octet-stream"),n.download="image.png",n.click()}()},children:"Save screenshot"})})]})})}),Object(c.jsx)(v.a,{item:!0,className:b.gridItem,children:Object(c.jsx)(m.a,{children:Object(c.jsxs)(g.a,{children:[Object(c.jsx)(O.a,{children:Object(c.jsx)("b",{children:"Test setups"})}),Ot.map((function(t,n){return Object(c.jsx)(O.a,{children:Object(c.jsx)("button",{onClick:function(){var t,e=[xt(t=n,0),xt(t,1)],o=Object(d.a)(e,2),u=o[0],a=o[1],c=function(){return r.multiplyScalar(r.newVec3(wt.next()-.5,wt.next()-.5,wt.next()-.5),1e-4)};u.bots.map((function(t){return t.pos=r.add(t.pos,c())})),a.bots.map((function(t){return t.pos=r.add(t.pos,c())})),ht(u),At(a),bt([u,a])},children:t.title})},n)}))]})})}),Object(c.jsx)(v.a,{item:!0,className:b.gridItem,children:Object(c.jsx)(m.a,{children:Object(c.jsx)(g.a,{children:Object(c.jsx)(O.a,{children:Object(c.jsx)("button",{onClick:function(){bt(a.createAnimation(pt,Mt,8))},children:"Generate animation"})})})})})]})}),Object(c.jsx)(v.a,{item:!0,xs:5,children:Object(c.jsx)("div",{ref:j})})]})})};b.a.render(Object(c.jsx)(s.a.StrictMode,{children:Object(c.jsx)(St,{})}),document.getElementById("root"))}},[[45,1,2]]]);
//# sourceMappingURL=main.9b79087a.chunk.js.map