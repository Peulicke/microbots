(this.webpackJsonpmicrobots=this.webpackJsonpmicrobots||[]).push([[0],{61:function(n,t){},66:function(n,t,e){"use strict";e.r(t);var r={};e.r(r),e.d(r,"newBot",(function(){return y})),e.d(r,"setPos",(function(){return S})),e.d(r,"setWeight",(function(){return E})),e.d(r,"setFixed",(function(){return M}));var o={};e.r(o),e.d(o,"newWorld",(function(){return N})),e.d(o,"setBots",(function(){return I})),e.d(o,"initEdges",(function(){return T})),e.d(o,"stiffness",(function(){return V})),e.d(o,"stiffnessDerivative",(function(){return W})),e.d(o,"stiffnessPair",(function(){return J})),e.d(o,"stiffnessPairDerivative",(function(){return $})),e.d(o,"removeFixedFromVector",(function(){return q})),e.d(o,"removeFixedFromMatrix",(function(){return G})),e.d(o,"assembleMatrix",(function(){return H})),e.d(o,"stiffnessMatrix",(function(){return R})),e.d(o,"stiffnessMatrixDerivativeBot",(function(){return U})),e.d(o,"stiffnessMatrixDerivativeEdge",(function(){return X})),e.d(o,"forceMatrix",(function(){return Y})),e.d(o,"inverse",(function(){return K})),e.d(o,"compliance",(function(){return L})),e.d(o,"complianceDerivative",(function(){return Z})),e.d(o,"complianceDerivativeBot",(function(){return _})),e.d(o,"complianceDerivativeEdge",(function(){return nn})),e.d(o,"distancePenalty",(function(){return tn})),e.d(o,"distancePenaltyDerivative",(function(){return en})),e.d(o,"distancePenaltyPair",(function(){return rn})),e.d(o,"distancePenaltyPairDerivative",(function(){return on})),e.d(o,"distancePenaltyTotal",(function(){return un})),e.d(o,"distancePenaltyTotalDerivativeBot",(function(){return cn})),e.d(o,"distancePenaltyTotalDerivativeEdge",(function(){return an})),e.d(o,"objective",(function(){return fn})),e.d(o,"objectiveDerivativeBot",(function(){return sn})),e.d(o,"objectiveDerivativeEdge",(function(){return ln})),e.d(o,"optimizeStepBots",(function(){return dn})),e.d(o,"optimizeStepEdges",(function(){return bn})),e.d(o,"resolveCollisionStep",(function(){return pn})),e.d(o,"resolveCollision",(function(){return mn})),e.d(o,"optimizeStep",(function(){return vn})),e.d(o,"optimizeStepNumericalBotDim",(function(){return hn})),e.d(o,"optimizeStepNumericalBot",(function(){return gn})),e.d(o,"optimizeStepNumerical",(function(){return xn})),e.d(o,"optimize",(function(){return On}));var u=e(5),i=e(0),c=e.n(i),a=e(14),f=e.n(a),s=e(8),l=e(38),d=e(7),b=e(1),p=e(39),m=e(83),v=e(85),j=e(86),h=e(87),g=e(89),x=e(45),O=e(25),w=e(40),y=function(){return{pos:new b.t(0,0,0),weight:1,fixed:!1}},S=function(n){return function(t){return t.pos=n,t}},E=function(n){return function(t){return t.weight=n,t}},M=function(n){return function(t){return t.fixed=n,t}},z=e(35),C=e.n(z),P=e(88),B=function(n,t){return(new b.h).set(n.x*t.x,n.x*t.y,n.x*t.z,n.y*t.x,n.y*t.y,n.y*t.z,n.z*t.x,n.z*t.y,n.z*t.z)},D=function(n,t){var e=new b.h;return e.elements=n.elements.map((function(n,e){return n+t.elements[e]})),e},A=function(n,t){return Object(d.a)(Array(n)).map((function(){return Object(d.a)(Array(t)).map((function(){return 0}))}))},F=function(n){var t=Object(d.a)(Array(3*n.length)).map((function(){return 0}));return n.map((function(n,e){for(var r=0;r<3;++r)t[3*e+r]=n.getComponent(r)})),t},k=function(n){var t,e=A(3*n.length,3*(null===(t=n[0])||void 0===t?void 0:t.length)||0);return n.map((function(t,r){return t.map((function(t,o){for(var u=0;u<3;++u)for(var i=0;i<3;++i)e[3*r+u][3*o+i]=n[r][o].elements[u+3*i]}))})),e},N=function(){return{bots:[],edges:[]}},I=function(n){return function(t){return t.bots=n,t}},T=function(n){var t=Object(d.a)(Array(n.bots.length)).map((function(){return 1})),e=t.map((function(n,e){return t.map((function(n,t){return e===t?0:1}))}));return n.edges=e,n},V=function(n){return B(n,n).multiplyScalar(-1/n.dot(n))},W=function(n){return function(t){var e=new b.t(0,0,0).setComponent(n,1),r=B(e,t),o=V(t);return D(D(r,r.clone().transpose()),o.multiplyScalar(2*t.getComponent(n))).multiplyScalar(-1/t.dot(t))}},J=function(n,t,e){return V(t.pos.clone().sub(n.pos)).multiplyScalar(e)},$=function(n){return function(t){return function(e,r,o){if(e!==n&&r!==n)return(new b.h).set(0,0,0,0,0,0,0,0,0);var u=W(t)(r.pos.clone().sub(e.pos)).multiplyScalar(o);return e===n?u.multiplyScalar(-1):u}}},q=function(n){return function(t){return t.filter((function(t,e){return!n.bots[e].fixed}))}},G=function(n){return function(t){return t.filter((function(t,e){return!n.bots[e].fixed})).map((function(t){return t.filter((function(t,e){return!n.bots[e].fixed}))}))}},H=function(n,t){var e=n.edges.map((function(){return n.edges.map((function(){return(new b.h).multiplyScalar(0)}))}));return e.forEach((function(r,o){r.forEach((function(r,u){if(o!==u){var i=t(n.bots[o],n.bots[u],n.edges[o][u]);e[o][o]=function(n,t){var e=new b.h;return e.elements=n.elements.map((function(n,e){return n-t.elements[e]})),e}(e[o][o],i),e[o][u]=D(e[o][u],i)}}))})),G(n)(e)},R=function(n){return H(n,J)},U=function(n){return function(t){return function(e){return H(e,$(n)(t))}}},X=function(n,t){return function(e){var r=Object(d.a)(Array(e.bots.length)).map((function(){return 0})),o=r.map((function(){return r}));o[n][t]=o[t][n]=1;var u=C()(e,{edges:{$set:o}});return R(u)}},Y=function(n){return q(n)(n.bots.map((function(n){return new b.t(0,-n.weight,0)})))},K=function(n){return function(n){var t;return A(n.length/3,((null===(t=n[0])||void 0===t?void 0:t.length)||0)/3).map((function(t,e){return t.map((function(t,r){for(var o=new b.h,u=0;u<3;++u)for(var i=0;i<3;++i)o.elements[u+3*i]=n[3*e+u][3*r+i];return o}))}))}(Object(P.a)(Object(P.b)(k(n))).toArray())},L=function(n){var t=Object(P.b)(F(Y(n))),e=Object(P.b)(k(R(n))),r=Object(P.d)(t),o=Object(P.a)(e);return Object(P.c)(Object(P.c)(r,o),t)},Q=function(n){return function(t){return Object(P.c)(t,n)}},Z=function(n){return function(t){var e=Object(P.b)(F(Y(t))),r=Object(P.b)(k(n(t))),o=Object(P.b)(k(R(t))),u=Object(P.d)(e),i=Object(P.a)(o);return-Object(O.a)(u,Q(i),Q(r),Q(i),Q(e))}},_=function(n){return function(t){return function(e){return Z(U(n)(t))(e)}}},nn=function(n,t){return function(e){return Z(X(n,t))(e)}},tn=function(n){return Math.pow(n.dot(n)-1,2)},en=function(n){return function(t){return(t.dot(t)-1)*t.getComponent(n)*4}},rn=function(n,t,e){return tn(t.pos.clone().sub(n.pos))*e},on=function(n){return function(t,e,r){return en(n)(e.pos.clone().sub(t.pos))*r}},un=function(n){var t=0;return n.edges.forEach((function(e,r){e.forEach((function(e,o){r>=o||(t+=rn(n.bots[r],n.bots[o],e))}))})),t},cn=function(n){return function(t){return function(e){var r=0;return e.edges.forEach((function(o,u){o.forEach((function(o,i){e.bots[i]===n&&(r+=on(t)(e.bots[u],e.bots[i],o))}))})),r}}},an=function(n,t){return function(e){return rn(e.bots[n],e.bots[t],1)}},fn=function(n){return L(n)+un(n)},sn=function(n){return function(t){return function(e){return function(r){return _(t)(e)(r)*(1-n)+cn(t)(e)(r)*n}}}},ln=function(n){return function(t,e){return function(r){return nn(t,e)(r)*(1-n)+an(t,e)(r)*n}}},dn=function(n){return function(t){return function(e){var r=e.bots.map((function(r){if(r.fixed)return r;var o=new b.t;[0,1,2].map((function(n){return o.setComponent(n,sn(t)(r)(n)(e))}));var u=o.multiplyScalar(n),i=u.length();return i>.3&&(u=u.multiplyScalar(.3/i)),S(r.pos.clone().sub(u))(r)}));return I(r)(e)}}},bn=function(n){return function(t){return function(e){for(var r=e.edges,o=0;o<e.bots.length;++o)for(var u=0;u<e.bots.length;++u)if(o!==u){var i=ln(t)(o,u)(e);r[o][u]=e.edges[o][u]-i*n,r[o][u]=Math.max(r[o][u],.001),r[o][u]=Math.min(r[o][u],1)}return C()(e,{edges:{$set:r}})}}},pn=function(n){for(var t=0;t<n.bots.length;++t)for(var e=t+1;e<n.bots.length;++e)if(!n.bots[t].fixed||!n.bots[e].fixed){var r=n.bots[t].fixed||n.bots[e].fixed,o=n.bots[e].pos.clone().sub(n.bots[t].pos),u=o.length();if(!(u>1)){var i=o.multiplyScalar((1-u)/(r?1:2)/u);n.bots[t].fixed||(n.bots[t].pos=n.bots[t].pos.clone().sub(i)),n.bots[e].fixed||(n.bots[e].pos=n.bots[e].pos.clone().add(i))}}return n},mn=function(n){for(var t=n,e=0;e<10;++e)t=pn(t);return t},vn=function(n){return function(t){return function(e){return Object(O.a)(e,dn(n)(t),bn(n)(t),mn)}}},jn=5,hn=function(n){return function(t){return function(e){return function(r){var o=e.pos.getComponent(r);e.pos.setComponent(r,o+.001);for(var u=0;u<t.bots.length;++u)for(var i=0;i<t.bots.length;++i)if(u!==i){var c=t.bots[i].pos.clone().sub(t.bots[u].pos).length();t.edges[u][i]=1/(1+Math.exp(4*(c-jn)))+.001}var a=L(t);e.pos.setComponent(r,o-.001);for(var f=0;f<t.bots.length;++f)for(var s=0;s<t.bots.length;++s)if(f!==s){var l=t.bots[s].pos.clone().sub(t.bots[f].pos).length();t.edges[f][s]=1/(1+Math.exp(4*(l-jn)))+.001}var d=L(t);e.pos.setComponent(r,o);var b=-(a-d)*n;Math.abs(b)>.5&&(b=.5*Math.sign(b)),e.pos.setComponent(r,o+b);for(var p=0;p<t.bots.length;++p)for(var m=0;m<t.bots.length;++m)if(p!==m){var v=t.bots[m].pos.clone().sub(t.bots[p].pos).length();t.edges[p][m]=1/(1+Math.exp(4*(v-jn)))+.001}return t}}}},gn=function(n){return function(t){return function(e){if(e.fixed)return t;var r=hn(n)(t)(e);return[0,1,2].map((function(n){return r(n)})),t}}},xn=function(n){return function(t){jn=1+.99*(jn-1),console.log(jn);var e=gn(n)(t);return t.bots.map((function(n){return e(n)})),mn(t)}},On=function(n){for(var t=n,e=0;e<100;++e)t=vn(.01)(.5)(t),console.log(t.bots[3].pos.toArray()),console.log(t.edges);return t},wn=new w.a(123),yn=Object(m.a)((function(n){return{gridItem:{padding:n.spacing(2),textAlign:"center"}}})),Sn=function(){return r.setPos(Object(l.a)(b.t,Object(d.a)([wn.next(),wn.next(),wn.next()].map((function(n){return 10*n})))))(r.newBot())},En=[r.setFixed(!0)(r.newBot()),r.setFixed(!0)(r.setPos(new b.t(3,0,0))(r.newBot())),r.setFixed(!0)(r.setPos(new b.t(0,0,2))(r.newBot())),Sn(),Sn(),Sn(),Sn(),Sn(),Sn(),Sn()],Mn=Object(O.a)(o.newWorld(),o.setBots(En),o.initEdges),zn=function(){var n=Object(x.a)(),t=Object(s.a)(n,2),e=t[0],r=t[1],c=.55*e,a=.9*r,f=yn(),l=Object(i.useRef)(null),d=Object(i.useState)(),m=Object(s.a)(d,2),O=m[0],w=m[1],y=Object(i.useState)(),S=Object(s.a)(y,2),E=S[0],M=S[1],z=Object(i.useState)(),C=Object(s.a)(z,2),P=C[0],B=C[1],D=Object(i.useState)(),A=Object(s.a)(D,2),F=A[0],k=A[1],N=Object(i.useState)(0),I=Object(s.a)(N,2),T=I[0],V=I[1],W=Object(i.useState)(0),J=Object(s.a)(W,2),$=J[0],q=J[1];return Object(i.useEffect)((function(){var n=l.current;if(n){var t=new b.m(75,c/a,.1,1e3);t.position.set(10,10,10),t.lookAt(0,0,0),B(t);var e=new b.u({antialias:!0});e.setClearColor("#000000"),e.setSize(c,a),n.appendChild(e.domElement),k(e);var r=new p.a(t,e.domElement);r.enableDamping=!0,r.dampingFactor=.5,w(r);var o=window.setInterval((function(){return V((function(n){return n+1}))}),1e3/30);return function(){window.clearInterval(o),n.removeChild(e.domElement)}}}),[l,c,a]),Object(i.useEffect)((function(){O&&O.update(),F&&E&&P&&F.render(E,P)}),[O,F,E,P,T]),Object(i.useEffect)((function(){if(!($>=300)){var n=setTimeout((function(){if(q($+1),$%4===0){var n=Mn.bots.map((function(n){return t=n.pos,e=n.fixed?new b.c(0,0,1):new b.c(0,1,0),function(n){var r=(new b.i).setPosition(t).scale(new b.t(.5,.5,.5)),o=new b.p(1,16,16).applyMatrix4(r);o.computeVertexNormals(),o.faces.forEach((function(n){return n.vertexColors=new Array(3).fill(!0).map((function(){return e}))}));var u=(new b.b).fromGeometry(o);delete u.attributes.uv;var i=new b.j(u,new b.k({color:e}));return i.geometry=u,i.matrixAutoUpdate=!1,i.matrix=r,i.updateMatrix(),n.add(i),n};var t,e})).reduce((function(n,t){return t(n)}),function(){var n=new b.o;n.add(new b.a(16777215,.4));var t=new b.e(16777215,.4);return t.position.set(0,1,0),n.add(t),n}());Mn.bots.map((function(t,e){return Mn.bots.map((function(r,o){e>=o||(n=function(n,t,e,r){return function(o){var u=(new b.t).subVectors(t,n),i=new b.i;i.lookAt(n,t,(new b.l).up),i.multiply((new b.i).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1));var c=new b.d(e,e,u.length(),8,1),a=new b.j(c,new b.k({color:r}));return a.applyMatrix4(i),a.position.x=(t.x+n.x)/2,a.position.y=(t.y+n.y)/2,a.position.z=(t.z+n.z)/2,o.add(a),o}}(t.pos,r.pos,.3*Math.sqrt(Mn.edges[e][o]),new b.c(1,0,0))(n))}))})),M(n)}Mn=o.optimizeStepNumerical(1)(Mn)}),10);return function(){return clearTimeout(n)}}}),[O,F,E,P,$]),Object(u.jsx)(u.Fragment,{children:Object(u.jsxs)(v.a,{container:!0,item:!0,xs:11,children:[Object(u.jsx)(v.a,{item:!0,xs:4,style:{height:.9*window.innerHeight,overflowX:"hidden",overflowY:"scroll"},children:Object(u.jsx)(v.a,{container:!0,direction:"column",children:Object(u.jsx)(v.a,{item:!0,className:f.gridItem,children:Object(u.jsx)(j.a,{children:Object(u.jsxs)(h.a,{children:[Object(u.jsx)(g.a,{children:Object(u.jsx)("b",{children:"Microbots"})}),Object(u.jsxs)(g.a,{children:[Object(u.jsx)("b",{children:"iterations: "}),$]})]})})})})}),Object(u.jsx)(v.a,{item:!0,xs:5,children:Object(u.jsx)("div",{ref:l})})]})})};f.a.render(Object(u.jsx)(c.a.StrictMode,{children:Object(u.jsx)(zn,{})}),document.getElementById("root"))}},[[66,1,2]]]);
//# sourceMappingURL=main.564d5711.chunk.js.map