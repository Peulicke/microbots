(this.webpackJsonpmicrobots=this.webpackJsonpmicrobots||[]).push([[0],{46:function(t,n,e){"use strict";e.r(n);var r={};e.r(r),e.d(r,"newBot",(function(){return O})),e.d(r,"setPos",(function(){return y})),e.d(r,"setWeight",(function(){return S})),e.d(r,"setFixed",(function(){return A})),e.d(r,"average",(function(){return M}));var o={};e.r(o),e.d(o,"newWorld",(function(){return D})),e.d(o,"setBots",(function(){return N})),e.d(o,"edgeStrength",(function(){return W})),e.d(o,"stiffness",(function(){return R})),e.d(o,"stiffnessDerivative",(function(){return q})),e.d(o,"stiffnessPair",(function(){return J})),e.d(o,"stiffnessPairDerivative",(function(){return T})),e.d(o,"removeFixedFromVector",(function(){return G})),e.d(o,"removeFixedFromMatrix",(function(){return H})),e.d(o,"stiffnessMatrix",(function(){return L})),e.d(o,"acceleration",(function(){return U})),e.d(o,"forceMatrix",(function(){return X})),e.d(o,"displacement",(function(){return Y})),e.d(o,"resolveCollisionStep",(function(){return K})),e.d(o,"resolveCollision",(function(){return Q})),e.d(o,"gradient",(function(){return Z}));var a={};e.r(a),e.d(a,"optimizeStepNumerical",(function(){return _})),e.d(a,"createAnimation",(function(){return nt}));var c=e(5),i=e(0),u=e.n(i),s=e(11),f=e.n(s),l=e(10),b=e(4),p=e(1),d=e(28),m=e(61),v=e(63),h=e(64),j=e(65),w=e(66),g=e(34),x=e(27),O=function(){return{pos:new p.t(0,0,0),weight:1,fixed:!1}},y=function(t){return function(n){return n.pos=t,n}},S=function(t){return function(n){return n.weight=t,n}},A=function(t){return function(n){return n.fixed=t,n}},M=function(t,n){var e=O();return e.pos=t.pos.clone().add(n.pos).divideScalar(2),e.weight=(t.weight+n.weight)/2,e.fixed=t.fixed||n.fixed,e},C=e(15),B=function(){throw new Error("Vectors need to be the same length")},E=function(t,n){t.length!==n.length&&B();for(var e=0,r=0;r<t.length;++r)e+=t[r]*n[r];return e},k=function(t,n){var e=new p.h;return e.elements=t.elements.map((function(t,e){return t+n.elements[e]})),e},z=function(t,n){var e=new p.h;return e.elements=t.elements.map((function(t,e){return t-n.elements[e]})),e},P=function(t,n){return Object(b.a)(Array(t)).map((function(){return Object(b.a)(Array(n)).map((function(){return 0}))}))},F=function(t){var n=Object(b.a)(Array(3*t.length)).map((function(){return 0}));return t.map((function(t,e){for(var r=0;r<3;++r)n[3*e+r]=t.getComponent(r)})),n},I=e(29),D=function(){return{bots:[]}},N=function(t){return function(n){return n.bots=t,n}},V=.1,W=function(t){return 2/(1+Math.exp(4*(t-1)))},R=function(t){return(n=t,e=t,n.length!==e.length&&B(),(new p.h).set(n.x*e.x,n.x*e.y,n.x*e.z,n.y*e.x,n.y*e.y,n.y*e.z,n.z*e.x,n.z*e.y,n.z*e.z)).multiplyScalar(-1/t.dot(t)).multiplyScalar(W(t.length()));var n,e},q=function(t){return function(n){var e=1e-5,r=n.getComponent(t),o=n.clone().setComponent(t,r+e),a=n.clone().setComponent(t,r-e),c=R(o),i=R(a);return z(c,i).multiplyScalar(1/2e-5)}},J=function(t,n){var e=n.pos.clone().sub(t.pos);return R(e)},T=function(t){return function(n){return function(e,r){if(e!==t&&r!==t)return(new p.h).set(0,0,0,0,0,0,0,0,0);var o=q(n)(r.pos.clone().sub(e.pos));return e===t?o.multiplyScalar(-1):o}}},G=function(t){return function(n){return n.map((function(n,e){return t.bots[e].fixed?new p.t(0,0,0):n}))}},H=function(t){return function(n){return n.map((function(n,e){return n.map((function(n,r){return t.bots[e].fixed||t.bots[r].fixed?(new p.h).multiplyScalar(0):n}))}))}},L=function(t){for(var n=t.bots.map((function(){return t.bots.map((function(){return(new p.h).multiplyScalar(0)}))})),e=0;e<t.bots.length;++e){var r=R(new p.t(t.bots[e].pos.y+.5,0,0)).multiplyScalar(V),o=R(new p.t(0,t.bots[e].pos.y+.5,0)),a=R(new p.t(0,0,t.bots[e].pos.y+.5)).multiplyScalar(V);n[e][e]=z(n[e][e],r),n[e][e]=z(n[e][e],o),n[e][e]=z(n[e][e],a)}for(var c=0;c<t.bots.length;++c)for(var i=0;i<t.bots.length;++i)if(c!==i){var u=J(t.bots[c],t.bots[i]);n[c][c]=z(n[c][c],u),n[c][i]=k(n[c][i],u)}return H(t)(n)},U=function(t,n,e){return function(r){return r.bots.map((function(o,a){var c=r.bots[a].pos.clone().sub(t.bots[a].pos.clone()).divideScalar(e);return n.bots[a].pos.clone().sub(r.bots[a].pos.clone()).divideScalar(e).sub(c).divideScalar(e)}))}},X=function(t,n,e){return function(r){var o=U(t,n,e)(r);return G(r)(r.bots.map((function(t,n){return new p.t(0,-1,0).sub(o[n]).multiplyScalar(t.weight)})))}},Y=function(t,n,e){return function(r){var o,a,c=F(X(t,n,e)(r)),i=function(t){var n,e=P(3*t.length,3*(null===(n=t[0])||void 0===n?void 0:n.length)||0);return t.map((function(n,r){return n.map((function(n,o){for(var a=0;a<3;++a)for(var c=0;c<3;++c)e[3*r+a][3*o+c]=t[r][o].elements[a+3*c]}))})),e}(L(r));return o=i,a=c,I.solve(o,a)}},K=function(t){for(var n=0;n<t.bots.length;++n)t.bots[n].fixed||(t.bots[n].pos.y=Math.max(t.bots[n].pos.y,.5));for(var e=0;e<t.bots.length;++e)for(var r=e+1;r<t.bots.length;++r)if(!t.bots[e].fixed||!t.bots[r].fixed){var o=t.bots[e].fixed||t.bots[r].fixed,a=t.bots[r].pos.clone().sub(t.bots[e].pos),c=a.length();if(!(c>1)){var i=a.multiplyScalar((1-c)/(o?1:2)/c);t.bots[e].fixed||(t.bots[e].pos=t.bots[e].pos.clone().sub(i)),t.bots[r].fixed||(t.bots[r].pos=t.bots[r].pos.clone().add(i))}}return t},Q=function(t){for(var n=t,e=0;e<10;++e)n=K(n);return n},Z=function(t,n,e,r,o){return function(a){for(var c=Y(n,e,o)(a),i=Object(b.a)(Array(a.bots.length)).map((function(){return new p.t(0,0,0)})),u=Object(b.a)(Array(a.bots.length)).map((function(){return[0,1,2].map((function(){return Object(b.a)(Array(a.bots.length)).map((function(){return new p.t(0,0,0)}))}))})),s=0;s<a.bots.length;++s)for(var f=0;f<3;++f){var l=q(f)(new p.t(a.bots[s].pos.y+.5,0,0)).multiplyScalar(V),d=q(f)(new p.t(0,a.bots[s].pos.y+.5,0)),m=q(f)(new p.t(0,0,a.bots[s].pos.y+.5)).multiplyScalar(V),v=Object(C.a)(p.t,Object(b.a)(c.slice(3*s,3*(s+1)))).applyMatrix3(l);u[s][f][s].sub(v);var h=Object(C.a)(p.t,Object(b.a)(c.slice(3*s,3*(s+1)))).applyMatrix3(d);u[s][f][s].sub(h);var j=Object(C.a)(p.t,Object(b.a)(c.slice(3*s,3*(s+1)))).applyMatrix3(m);u[s][f][s].sub(j);for(var w=0;w<a.bots.length;++w)if(!(s>=w)){var g=T(a.bots[s])(f)(a.bots[s],a.bots[w]),x=Object(C.a)(p.t,Object(b.a)(c.slice(3*s,3*(s+1)))).applyMatrix3(g),O=Object(C.a)(p.t,Object(b.a)(c.slice(3*w,3*(w+1)))).applyMatrix3(g).sub(x);u[s][f][s].add(O),u[s][f][w].sub(O),u[w][f][w].add(O),u[w][f][s].sub(O)}}for(var y=Y(t,a,o)(n),S=Y(a,r,o)(e),A=0;A<a.bots.length;++A)for(var M=0;M<3;++M){var B=F(G(a)(u[A][M]));i[A].setComponent(M,-E(c,B)+(2*c[3*A+M]-y[3*A+M]-S[3*A+M])/Math.pow(o,2)*2)}return i}},$=function(t,n){var e=D();return e.bots=t.bots.map((function(t,e){return M(t,n.bots[e])})),e},_=function(t){return function(n,e,r,o,a){return function(c){var i=Z(n,e,r,o,a)(c).map((function(n){return n.multiplyScalar(-t/(1+n.length()))}));return c.bots.map((function(t,n){t.fixed||t.pos.add(i[n])})),Q(c)}}},tt=function(t){for(var n=Object(b.a)(Array(2*t.length-1)),e=0;e<t.length;++e)n[2*e]=t[e];for(var r=1;r<n.length-1;r+=2)n[r]=$(n[r-1],n[r+1]);return n},nt=function(t,n,e){for(var r=[t,n],o=100,a=.1,c=0;c<e;++c){o/=2,a/=2,r=tt(r);for(var i=0;i<30;++i){for(var u=1;u<r.length-1;u+=2)_(a)(r[Math.max(u-2,0)],r[u-1],r[u+1],r[Math.min(u+2,r.length-1)],o)(r[u]);for(var s=2;s<r.length-2;s+=2)_(a)(r[s-2],r[s-1],r[s+1],r[s+2],o)(r[s])}}return _(.1)(r[0],r[0],r[2],r[2],o)(r[1]),r},et=function(t,n,e){return function(r){var o,a=(new p.t).subVectors(n,t),c=new p.i;return c.lookAt(t,n,(new p.l).up),c.multiply((new p.i).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1)),r.setRotationFromMatrix(c),r.scale.set(e,a.length(),e),(o=r.position).set.apply(o,Object(b.a)(t.clone().add(n).divideScalar(2).toArray())),r}},rt=function(t,n,e,r){var o=new p.d(1,1,1,8,1),a=new p.j(o,new p.k({color:r}));return et(t,n,e)(a)},ot=Object(m.a)((function(t){return{gridItem:{padding:t.spacing(2),textAlign:"center"}}})),at=Object(x.a)(o.newWorld(),o.setBots([].concat(Object(b.a)(Object(b.a)(Array(3)).map((function(t,n){return[r.setPos(new p.t(-4,.5+n,0))(r.newBot()),r.setPos(new p.t(4,.5+n,0))(r.newBot())]})).flat()),[r.setPos(new p.t(-4,3.5,0))(r.newBot())]))),ct=Object(x.a)(o.newWorld(),o.setBots([].concat(Object(b.a)(Object(b.a)(Array(3)).map((function(t,n){return[r.setPos(new p.t(-4,.5+n,0))(r.newBot()),r.setPos(new p.t(4,.5+n,0))(r.newBot())]})).flat()),[r.setPos(new p.t(4,3.5,0))(r.newBot())]))),it=a.createAnimation(at,ct,8),ut=it[0].bots.map((function(t){return function(t,n){var e,r=new p.p(1,16,16);r.computeVertexNormals(),r.faces.forEach((function(t){return t.vertexColors=new Array(3).fill(!0).map((function(){return n}))}));var o=(new p.b).fromGeometry(r);delete o.attributes.uv;var a=new p.j(o,new p.k({color:n}));return a.geometry=o,(e=a.position).set.apply(e,Object(b.a)(t.toArray())),a.scale.set(.5,.5,.5),a}(t.pos,t.fixed?new p.c(0,0,1):new p.c(0,1,0))})),st=it[0].bots.map((function(t){return rt(t.pos,new p.t(t.pos.x,0,t.pos.z),1,new p.c(1,0,0))})),ft=it[0].bots.map((function(t){return it[0].bots.map((function(n){return rt(t.pos,n.pos,1,new p.c(1,0,0))}))})),lt=function(){var t=new p.o;t.add(new p.a(16777215,.4));var n=new p.e(16777215,.4);return n.position.set(0,1,0),t.add(n),t}();ut.map((function(t){return lt.add(t)})),st.map((function(t){return lt.add(t)})),ft.map((function(t,n){return t.map((function(t,e){n>=e||lt.add(t)}))}));var bt=function(t){it[t].bots.map((function(t,n){var e;(e=ut[n].position).set.apply(e,Object(b.a)(t.pos.toArray()))})),it[t].bots.map((function(t,n){lt.remove(st[n]);var e=o.edgeStrength(t.pos.y+.5);e<.01||(lt.add(st[n]),et(t.pos,new p.t(t.pos.x,0,t.pos.z),.3*Math.sqrt(e))(st[n]))})),it[t].bots.map((function(n,e){return it[t].bots.map((function(t,r){if(!(e>=r)){lt.remove(ft[e][r]);var a=o.edgeStrength(t.pos.clone().sub(n.pos).length());a<.01||(lt.add(ft[e][r]),et(n.pos,t.pos,.3*Math.sqrt(a))(ft[e][r]))}}))}))},pt=function(){var t=Object(g.a)(),n=Object(l.a)(t,2),e=n[0],r=n[1],o=.55*e,a=.9*r,u=ot(),s=Object(i.useRef)(null),f=Object(i.useState)(),b=Object(l.a)(f,2),m=b[0],x=b[1],O=Object(i.useState)(),y=Object(l.a)(O,2),S=y[0],A=y[1],M=Object(i.useState)(),C=Object(l.a)(M,2),B=C[0],E=C[1],k=Object(i.useState)(0),z=Object(l.a)(k,2),P=z[0],F=z[1],I=Object(i.useState)(0),D=Object(l.a)(I,2),N=D[0],V=D[1],W=Object(i.useState)(!1),R=Object(l.a)(W,2),q=R[0],J=R[1];return Object(i.useEffect)((function(){var t=s.current;if(t){var n=new p.m(75,o/a,.1,1e3);n.position.set(10,10,10),n.lookAt(0,0,0),A(n);var e=new p.u({antialias:!0});e.setClearColor("#000000"),e.setSize(o,a),t.appendChild(e.domElement),E(e);var r=new d.a(n,e.domElement);r.enableDamping=!0,r.dampingFactor=.5,x(r);var c=window.setInterval((function(){return F((function(t){return t+1}))}),1e3/30);return function(){window.clearInterval(c),t.removeChild(e.domElement)}}}),[s,o,a]),Object(i.useEffect)((function(){m&&m.update(),B&&S&&B.render(lt,S)}),[m,B,S,P]),Object(i.useEffect)((function(){var t=Math.round(.1*it.length),n=N%(2*(it.length+t));n<t?bt(0):(n-=t)<it.length?bt(n):(n-=it.length)<t?bt(it.length-1):(n-=t,bt(it.length-1-n))}),[N]),Object(i.useEffect)((function(){if(q){var t=setInterval((function(){return V((function(t){return t+1}))}),10);return function(){return clearInterval(t)}}}),[q]),Object(c.jsx)(c.Fragment,{children:Object(c.jsxs)(v.a,{container:!0,item:!0,xs:11,children:[Object(c.jsx)(v.a,{item:!0,xs:4,style:{height:.9*window.innerHeight,overflowX:"hidden",overflowY:"scroll"},children:Object(c.jsx)(v.a,{container:!0,direction:"column",children:Object(c.jsx)(v.a,{item:!0,className:u.gridItem,children:Object(c.jsx)(h.a,{children:Object(c.jsxs)(j.a,{children:[Object(c.jsx)(w.a,{children:Object(c.jsx)("b",{children:"Microbots"})}),Object(c.jsx)(w.a,{children:Object(c.jsxs)("button",{onClick:function(){return V(N+1)},children:["Time: ",N]})}),Object(c.jsx)(w.a,{children:Object(c.jsxs)("button",{onClick:function(){return J(!q)},children:["Animating: ",q?"true":"false"]})}),Object(c.jsx)(w.a,{children:Object(c.jsx)("button",{onClick:function(){return function(){var t=document.getElementsByTagName("canvas")[0].toDataURL("image/png"),n=document.createElement("a");n.href=t.replace(/^data:image\/[^;]/,"data:application/octet-stream"),n.download="image.png",n.click()}()},children:"Save screenshot"})})]})})})})}),Object(c.jsx)(v.a,{item:!0,xs:5,children:Object(c.jsx)("div",{ref:s})})]})})};f.a.render(Object(c.jsx)(u.a.StrictMode,{children:Object(c.jsx)(pt,{})}),document.getElementById("root"))}},[[46,1,2]]]);
//# sourceMappingURL=main.af39a158.chunk.js.map