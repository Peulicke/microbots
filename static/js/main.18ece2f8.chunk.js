(this.webpackJsonpmicrobots=this.webpackJsonpmicrobots||[]).push([[0],{47:function(t,n,e){"use strict";e.r(n);var r={};e.r(r),e.d(r,"newBot",(function(){return y})),e.d(r,"setPos",(function(){return S})),e.d(r,"setWeight",(function(){return C})),e.d(r,"setFixed",(function(){return A}));var o={};e.r(o),e.d(o,"newWorld",(function(){return P})),e.d(o,"setBots",(function(){return D})),e.d(o,"initEdges",(function(){return I})),e.d(o,"stiffness",(function(){return J})),e.d(o,"stiffnessDerivative",(function(){return R})),e.d(o,"stiffnessPair",(function(){return T})),e.d(o,"stiffnessPairDerivative",(function(){return q})),e.d(o,"removeFixedFromVector",(function(){return G})),e.d(o,"removeFixedFromMatrix",(function(){return H})),e.d(o,"stiffnessMatrix",(function(){return X})),e.d(o,"stiffnessMatrixDerivative",(function(){return Y})),e.d(o,"forceMatrix",(function(){return K})),e.d(o,"displacement",(function(){return L})),e.d(o,"compliance",(function(){return Q})),e.d(o,"objective",(function(){return U})),e.d(o,"resolveCollisionStep",(function(){return Z})),e.d(o,"resolveCollision",(function(){return $})),e.d(o,"optimizeStepNumericalBotDim",(function(){return tt})),e.d(o,"optimizeStepNumericalBot",(function(){return nt})),e.d(o,"gradient",(function(){return et})),e.d(o,"optimizeStepNumerical",(function(){return rt}));var u=e(5),i=e(0),c=e.n(i),a=e(11),s=e.n(a),f=e(10),l=e(17),p=e(4),d=e(1),b=e(27),m=e(62),v=e(64),h=e(65),j=e(66),g=e(67),w=e(35),x=e(28),O=e(29),y=function(){return{pos:new d.t(0,0,0),weight:1,fixed:!1}},S=function(t){return function(n){return n.pos=t,n}},C=function(t){return function(n){return n.weight=t,n}},A=function(t){return function(n){return n.fixed=t,n}},M=function(){throw new Error("Vectors need to be the same length")},E=function(t,n){t.length!==n.length&&M();for(var e=0,r=0;r<t.length;++r)e+=t[r]*n[r];return e},z=function(t,n){var e=new d.h;return e.elements=t.elements.map((function(t,e){return t+n.elements[e]})),e},F=function(t,n){var e=new d.h;return e.elements=t.elements.map((function(t,e){return t-n.elements[e]})),e},B=function(t,n){return Object(p.a)(Array(t)).map((function(){return Object(p.a)(Array(n)).map((function(){return 0}))}))},k=function(t){var n=Object(p.a)(Array(3*t.length)).map((function(){return 0}));return t.map((function(t,e){for(var r=0;r<3;++r)n[3*e+r]=t.getComponent(r)})),n},N=e(30),P=function(){return{bots:[],edges:[]}},D=function(t){return function(n){return n.bots=t,n}},I=function(t){var n=Object(p.a)(Array(t.bots.length)).map((function(){return 1})),e=n.map((function(t,e){return n.map((function(t,n){return e===n?0:1}))}));return t.edges=e,t},V=4,W=function(t){return 2/(1+Math.exp(V*(t-1)))},J=function(t){return(n=t,e=t,n.length!==e.length&&M(),(new d.h).set(n.x*e.x,n.x*e.y,n.x*e.z,n.y*e.x,n.y*e.y,n.y*e.z,n.z*e.x,n.z*e.y,n.z*e.z)).multiplyScalar(-1/t.dot(t));var n,e},R=function(t){return function(n){return function(e){var r=1e-5,o=e.getComponent(n),u=e.clone().setComponent(n,o+r),i=e.clone().setComponent(n,o-r),c=J(u).multiplyScalar(t(u.length())),a=J(i).multiplyScalar(t(i.length()));return F(c,a).multiplyScalar(1/2e-5)}}},T=function(t,n,e){return J(n.pos.clone().sub(t.pos)).multiplyScalar(e)},q=function(t){return function(n){return function(e){return function(r,o){if(r!==n&&o!==n)return(new d.h).set(0,0,0,0,0,0,0,0,0);var u=R(t)(e)(o.pos.clone().sub(r.pos));return r===n?u.multiplyScalar(-1):u}}}},G=function(t){return function(n){return n.map((function(n,e){return t.bots[e].fixed?new d.t(0,0,0):n}))}},H=function(t){return function(n){return n.map((function(n,e){return n.map((function(n,r){return t.bots[e].fixed||t.bots[r].fixed?(new d.h).multiplyScalar(0):n}))}))}},X=function(t){for(var n=t.bots.map((function(){return t.bots.map((function(){return(new d.h).multiplyScalar(0)}))})),e=0;e<t.bots.length;++e)for(var r=0;r<t.bots.length;++r)if(e!==r){var o=T(t.bots[e],t.bots[r],t.edges[e][r]);n[e][e]=F(n[e][e],o),n[e][r]=z(n[e][r],o)}return H(t)(n)},Y=function(t){return function(n){return function(e){return function(r){var o=r.edges.map((function(){return r.edges.map((function(){return(new d.h).multiplyScalar(0)}))})),u=r.bots[n];return r.bots.forEach((function(i,c){if(n!==c){var a=q(t)(u)(e)(r.bots[n],r.bots[c]);o[n][n]=F(o[n][n],a),o[c][c]=F(o[c][c],a),o[n][c]=z(o[n][c],a),o[c][n]=z(o[c][n],a)}})),H(r)(o)}}}},K=function(t){return G(t)(t.bots.map((function(t){return new d.t(0,-t.weight,0)})))},L=function(t){var n,e,r=k(K(t)),o=function(t){var n,e=B(3*t.length,3*(null===(n=t[0])||void 0===n?void 0:n.length)||0);return t.map((function(n,r){return n.map((function(n,o){for(var u=0;u<3;++u)for(var i=0;i<3;++i)e[3*r+u][3*o+i]=t[r][o].elements[u+3*i]}))})),e}(X(t));return n=o,e=r,N.solve(n,e)},Q=function(t){var n=k(K(t)),e=L(t);return E(n,e)},U=function(t){return Q(t)},Z=function(t){for(var n=0;n<t.bots.length;++n)for(var e=n+1;e<t.bots.length;++e)if(!t.bots[n].fixed||!t.bots[e].fixed){var r=t.bots[n].fixed||t.bots[e].fixed,o=t.bots[e].pos.clone().sub(t.bots[n].pos),u=o.length();if(!(u>1)){var i=o.multiplyScalar((1-u)/(r?1:2)/u);t.bots[n].fixed||(t.bots[n].pos=t.bots[n].pos.clone().sub(i)),t.bots[e].fixed||(t.bots[e].pos=t.bots[e].pos.clone().add(i))}}return t},$=function(t){for(var n=t,e=0;e<10;++e)n=Z(n);return n},_=function(t){for(var n=0;n<t.bots.length;++n)for(var e=0;e<t.bots.length;++e)if(n!==e){var r=t.bots[e].pos.clone().sub(t.bots[n].pos).length();t.edges[n][e]=W(r)}},tt=function(t){return function(n){return function(e){return function(r){var o=e.pos.getComponent(r);e.pos.setComponent(r,o+.001),_(n);var u=Q(n);e.pos.setComponent(r,o-.001),_(n);var i=Q(n);e.pos.setComponent(r,o);var c=-(u-i)*t;return Math.abs(c)>.5&&(c=.5*Math.sign(c)),e.pos.setComponent(r,o+c),_(n),n}}}},nt=function(t){return function(n){return function(e){if(e.fixed)return n;var r=tt(t)(n)(e);return[0,1,2].map((function(t){return r(t)})),n}}},et=function(t){return function(n){for(var e=L(n),r=Object(p.a)(Array(n.bots.length)).map((function(){return new d.t(0,0,0)})),o=Object(p.a)(Array(n.bots.length)).map((function(){return[0,1,2].map((function(){return Object(p.a)(Array(n.bots.length)).map((function(){return new d.t(0,0,0)}))}))})),u=0;u<n.bots.length;++u)for(var i=0;i<3;++i)for(var c=0;c<n.bots.length;++c)if(!(u>=c)){var a=q(t)(n.bots[u])(i)(n.bots[u],n.bots[c]),s=Object(l.a)(d.t,Object(p.a)(e.slice(3*u,3*(u+1)))).applyMatrix3(a),f=Object(l.a)(d.t,Object(p.a)(e.slice(3*c,3*(c+1)))).applyMatrix3(a).sub(s);o[u][i][u].add(f),o[u][i][c].sub(f),o[c][i][c].add(f),o[c][i][u].sub(f)}for(var b=0;b<n.bots.length;++b)for(var m=0;m<3;++m){var v=k(G(n)(o[b][m]));r[b].setComponent(m,-E(e,v))}return r}},rt=function(t){return function(n){V*=1.005,console.log(V),_(n);var e=et(W)(n).map((function(n){return n.multiplyScalar(-t/(1+n.length()))}));return n.bots.map((function(t,n){t.fixed||t.pos.add(e[n])})),$(n)}},ot=function(t,n,e){return function(r){var o,u=(new d.t).subVectors(n,t),i=new d.i;return i.lookAt(t,n,(new d.l).up),i.multiply((new d.i).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1)),r.setRotationFromMatrix(i),r.scale.set(e,u.length(),e),(o=r.position).set.apply(o,Object(p.a)(t.clone().add(n).divideScalar(2).toArray())),r}},ut=new O.a(123),it=Object(m.a)((function(t){return{gridItem:{padding:t.spacing(2),textAlign:"center"}}})),ct=[r.setFixed(!0)(r.newBot()),r.setFixed(!0)(r.setPos(new d.t(3,0,0))(r.newBot())),r.setFixed(!0)(r.setPos(new d.t(0,0,2))(r.newBot()))].concat(Object(p.a)(Object(p.a)(Array(97)).map((function(){return r.setPos(Object(l.a)(d.t,Object(p.a)([ut.next(),ut.next(),ut.next()].map((function(t){return 10*t})))))(r.newBot())})))),at=Object(x.a)(o.newWorld(),o.setBots(ct),o.initEdges),st=ct.map((function(t){return function(t,n){var e,r=new d.p(1,16,16);r.computeVertexNormals(),r.faces.forEach((function(t){return t.vertexColors=new Array(3).fill(!0).map((function(){return n}))}));var o=(new d.b).fromGeometry(r);delete o.attributes.uv;var u=new d.j(o,new d.k({color:n}));return u.geometry=o,(e=u.position).set.apply(e,Object(p.a)(t.toArray())),u.scale.set(.5,.5,.5),u}(t.pos,t.fixed?new d.c(0,0,1):new d.c(0,1,0))})),ft=ct.map((function(t){return ct.map((function(n){return function(t,n,e,r){var o=new d.d(1,1,1,8,1),u=new d.j(o,new d.k({color:r}));return ot(t,n,e)(u)}(t.pos,n.pos,1,new d.c(1,0,0))}))})),lt=function(){var t=new d.o;t.add(new d.a(16777215,.4));var n=new d.e(16777215,.4);return n.position.set(0,1,0),t.add(n),t}();st.map((function(t){return lt.add(t)})),ft.map((function(t,n){return t.map((function(t,e){n>=e||lt.add(t)}))}));var pt=function(){var t=Object(w.a)(),n=Object(f.a)(t,2),e=n[0],r=n[1],c=.55*e,a=.9*r,s=it(),l=Object(i.useRef)(null),m=Object(i.useState)(),x=Object(f.a)(m,2),O=x[0],y=x[1],S=Object(i.useState)(),C=Object(f.a)(S,2),A=C[0],M=C[1],E=Object(i.useState)(),z=Object(f.a)(E,2),F=z[0],B=z[1],k=Object(i.useState)(0),N=Object(f.a)(k,2),P=N[0],D=N[1],I=Object(i.useState)(0),V=Object(f.a)(I,2),W=V[0],J=V[1];return Object(i.useEffect)((function(){var t=l.current;if(t){var n=new d.m(75,c/a,.1,1e3);n.position.set(10,10,10),n.lookAt(0,0,0),M(n);var e=new d.u({antialias:!0});e.setClearColor("#000000"),e.setSize(c,a),t.appendChild(e.domElement),B(e);var r=new b.a(n,e.domElement);r.enableDamping=!0,r.dampingFactor=.5,y(r);var o=window.setInterval((function(){return D((function(t){return t+1}))}),1e3/30);return function(){window.clearInterval(o),t.removeChild(e.domElement)}}}),[l,c,a]),Object(i.useEffect)((function(){O&&O.update(),F&&A&&F.render(lt,A)}),[O,F,A,P]),Object(i.useEffect)((function(){if(!(W>=150)){var t=setTimeout((function(){(at=o.optimizeStepNumerical(.1)(at)).bots.map((function(t,n){var e;(e=st[n].position).set.apply(e,Object(p.a)(t.pos.toArray()))})),at.bots.map((function(t,n){return at.bots.map((function(e,r){n>=r||(lt.remove(ft[n][r]),at.edges[n][r]<.01||(lt.add(ft[n][r]),ot(t.pos,e.pos,.3*Math.sqrt(at.edges[n][r]))(ft[n][r])))}))})),J(W+1)}),10);return function(){return clearTimeout(t)}}}),[W]),Object(u.jsx)(u.Fragment,{children:Object(u.jsxs)(v.a,{container:!0,item:!0,xs:11,children:[Object(u.jsx)(v.a,{item:!0,xs:4,style:{height:.9*window.innerHeight,overflowX:"hidden",overflowY:"scroll"},children:Object(u.jsx)(v.a,{container:!0,direction:"column",children:Object(u.jsx)(v.a,{item:!0,className:s.gridItem,children:Object(u.jsx)(h.a,{children:Object(u.jsxs)(j.a,{children:[Object(u.jsx)(g.a,{children:Object(u.jsx)("b",{children:"Microbots"})}),Object(u.jsxs)(g.a,{children:[Object(u.jsx)("b",{children:"iterations: "}),W]})]})})})})}),Object(u.jsx)(v.a,{item:!0,xs:5,children:Object(u.jsx)("div",{ref:l})})]})})};s.a.render(Object(u.jsx)(c.a.StrictMode,{children:Object(u.jsx)(pt,{})}),document.getElementById("root"))}},[[47,1,2]]]);
//# sourceMappingURL=main.18ece2f8.chunk.js.map