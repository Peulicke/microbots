(this.webpackJsonpmicrobots=this.webpackJsonpmicrobots||[]).push([[0],{48:function(t,n,e){"use strict";e.r(n);var r={};e.r(r),e.d(r,"newVec3",(function(){return S})),e.d(r,"clone",(function(){return y})),e.d(r,"add",(function(){return M})),e.d(r,"sub",(function(){return A})),e.d(r,"multiplyScalar",(function(){return E})),e.d(r,"divideScalar",(function(){return C})),e.d(r,"dot",(function(){return k})),e.d(r,"length",(function(){return I})),e.d(r,"normalize",(function(){return B}));var o={};e.r(o),e.d(o,"newBot",(function(){return D})),e.d(o,"setPos",(function(){return F})),e.d(o,"setWeight",(function(){return G})),e.d(o,"setFixed",(function(){return P})),e.d(o,"average",(function(){return R}));var a={};e.r(a),e.d(a,"newWorld",(function(){return X})),e.d(a,"setBots",(function(){return Y})),e.d(a,"setSlack",(function(){return Z})),e.d(a,"edgeStrength",(function(){return _})),e.d(a,"edgeStrengthGround",(function(){return tt})),e.d(a,"stiffness",(function(){return nt})),e.d(a,"stiffnessGround",(function(){return et})),e.d(a,"stiffnessDerivative",(function(){return rt})),e.d(a,"stiffnessPair",(function(){return ot})),e.d(a,"stiffnessPairDerivative",(function(){return at})),e.d(a,"stiffnessMatrix",(function(){return ct})),e.d(a,"forceMatrix",(function(){return ut})),e.d(a,"displacement",(function(){return it})),e.d(a,"resolveCollisionStep",(function(){return st})),e.d(a,"resolveCollision",(function(){return ft})),e.d(a,"gradient",(function(){return bt}));var c={};e.r(c),e.d(c,"createAnimation",(function(){return ht}));var u=e(3),i=e(0),s=e.n(i),f=e(12),b=e.n(f),l=e(5),d=e(7),p=e(2),h=e(29),j=e(63),v=e(65),m=e(66),O=e(67),g=e(69),x=e(70),w=e(35),S=function(t,n,e){return[t,n,e]},y=function(t){return[t[0],t[1],t[2]]},M=function(t,n){return[t[0]+n[0],t[1]+n[1],t[2]+n[2]]},A=function(t,n){return[t[0]-n[0],t[1]-n[1],t[2]-n[2]]},E=function(t,n){return[t[0]*n,t[1]*n,t[2]*n]},C=function(t,n){return[t[0]/n,t[1]/n,t[2]/n]},k=function(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]},I=function(t){return Math.sqrt(k(t,t))},B=function(t){return C(t,I(t))},V=function(t,n,e){return[t,n,e]},q=function(t,n){return[M(t[0],n[0]),M(t[1],n[1]),M(t[2],n[2])]},N=function(t,n){return[E(t[0],n),E(t[1],n),E(t[2],n)]},W=function(t,n){return[k(t[0],n),k(t[1],n),k(t[2],n)]},D=function(){return{pos:S(0,0,0),weight:1,fixed:!1}},F=function(t){return function(n){return n.pos=t,n}},G=function(t){return function(n){return n.weight=t,n}},P=function(t){return function(n){return n.fixed=t,n}},R=function(t,n){var e=D();return e.pos=C(M(t.pos,n.pos),2),e.weight=(t.weight+n.weight)/2,e.fixed=t.fixed||n.fixed,e},T=function(t,n){t.length!==n.length&&function(){throw new Error("Vectors need to be the same length")}();for(var e=0,r=0;r<t.length;++r)e+=t[r]*n[r];return e},z=function(t,n){return V(S(t[0]*n[0],t[0]*n[1],t[0]*n[2]),S(t[1]*n[0],t[1]*n[1],t[1]*n[2]),S(t[2]*n[0],t[2]*n[1],t[2]*n[2]))},J=function(t,n){for(var e=0,r=0;r<t.length;++r)e+=t[r]*n[r];return e},H=function(t,n,e){return t.map((function(t,r){return t+n[r]*e}))},L=function(t,n){for(var e=n.map((function(){return 0})),r=0;r<t.length;++r){var o=t[r][0],a=t[r][1],c=t[r][2];e[o]+=c*n[a]}return e},U=function(t,n){var e=function(t,n){n=n.map((function(t){return t}));for(var e=Object(l.a)(Array(n.length/3)).map((function(){return 0})),r=0;r<t.length;++r){var o=Object(d.a)(t[r],3),a=o[0],c=o[1],u=o[2];Math.floor(a/3)===Math.floor(c/3)&&(e[Math.floor(a/3)]+=u)}e.map((function(t,n){return e[n]=Math.sqrt(3/t)}));for(var i=0;i<t.length;++i)t[i][2]*=e[Math.floor(t[i][0]/3)];for(var s=0;s<n.length;++s)n[s]*=e[Math.floor(s/3)];return[t,n]}(t,n);return function(t,n){for(var e=n.map((function(){return 0})),r=H(n,L(t,e),-1),o=r.map((function(t){return t})),a=J(r,r),c=0;c<10;++c){var u=L(t,o),i=a/J(o,u);e=H(e,o,i),r=H(r,u,-i);var s=J(r,r);o=H(r,o,s/a),a=s}return e}(e[0],e[1])},X=function(){return{bots:[]}},Y=function(t){return function(n){return n.bots=t,n}},K=1.5,Q=2,Z=function(t){Q=t},$=.1,_=function(t){return t<K-Q/2?1:t>K+Q/2?0:2*(t+Q-K)*Math.pow(K+Q/2-t,2)/Math.pow(Q,3)},tt=function(t){return _(t)+1e-4},nt=function(t){var n=I(t);return t=E(t,Math.sqrt(_(n))/n),z(t,t)},et=function(t){return N(z(t,t),tt(I(t))/k(t,t))},rt=function(t){return function(n){var e=1e-5,r=n[t],o=y(n);o[t]=r+e;var a=y(n);a[t]=r-e;var c,u,i=nt(o),s=nt(a);return N((u=s,[A((c=i)[0],u[0]),A(c[1],u[1]),A(c[2],u[2])]),1/2e-5)}},ot=function(t,n){var e=A(n.pos,t.pos);return nt(e)},at=function(t){return function(n){return function(e,r){if(e!==t&&r!==t)return V(S(0,0,0),S(0,0,0),S(0,0,0));var o=rt(n)(A(r.pos,e.pos));return e===t?o:N(o,-1)}}},ct=function(t){for(var n=[],e=0;e<t.bots.length;++e)for(var r=N(et(S(t.bots[e].pos[1]+.5,0,0)),$),o=et(S(0,t.bots[e].pos[1]+.5,0)),a=N(et(S(0,0,t.bots[e].pos[1]+.5)),$),c=q(q(r,o),a),u=0;u<3;++u)for(var i=0;i<3;++i)n.push([3*e+u,3*e+i,c[u][i]]);for(var s=0;s<t.bots.length;++s)for(var f=0;f<t.bots.length;++f)if(s!==f&&!(I(A(t.bots[s].pos,t.bots[f].pos))>K+Q/2)){for(var b=ot(t.bots[s],t.bots[f]),l=0;l<3;++l)for(var d=0;d<3;++d)n[9*s+3*l+d][2]+=b[l][d];for(var p=0;p<3;++p)for(var h=0;h<3;++h)n.push([3*s+p,3*f+h,-b[p][h]])}return n},ut=function(t,n,e){return function(r){var o=Object(l.a)(Array(3*r.bots.length)).map((function(){return 0}));return r.bots.forEach((function(a,c){for(var u=0;u<3;++u){var i=(r.bots[c].pos[u]-t.bots[c].pos[u])/e,s=((n.bots[c].pos[u]-r.bots[c].pos[u])/e-i)/e;o[3*c+u]=((1===u?-1:0)-s)*a.weight}})),o}},it=function(t,n,e){return function(r){var o=ut(t,n,e)(r),a=ct(r);return U(a,o)}},st=function(t){for(var n=0;n<t.bots.length;++n)t.bots[n].fixed||(t.bots[n].pos[1]=Math.max(t.bots[n].pos[1],.5));for(var e=0;e<t.bots.length;++e)for(var r=e+1;r<t.bots.length;++r)if(!t.bots[e].fixed||!t.bots[r].fixed){var o=t.bots[e].fixed||t.bots[r].fixed,a=A(t.bots[r].pos,t.bots[e].pos),c=I(a);if(!(c>1)){var u=E(a,(1-c)/(o?1:2)/c);t.bots[e].fixed||(t.bots[e].pos=A(t.bots[e].pos,u)),t.bots[r].fixed||(t.bots[r].pos=M(t.bots[r].pos,u))}}return t},ft=function(t){for(var n=t,e=0;e<10;++e)n=st(n);return n},bt=function(t,n,e){return function(r,o,a,c,u){return function(i){for(var s=Object(l.a)(Array(i.bots.length)).map((function(){return S(0,0,0)})),f=Object(l.a)(Array(i.bots.length)).map((function(){return[0,1,2].map((function(){return Object(l.a)(Array(3*i.bots.length)).map((function(){return 0}))}))})),b=0;b<i.bots.length;++b)for(var d=0;d<3;++d){for(var p=N(rt(d)(S(i.bots[b].pos[1]+.5,0,0)),$),h=rt(d)(S(0,i.bots[b].pos[1]+.5,0)),j=N(rt(d)(S(0,0,i.bots[b].pos[1]+.5)),$),v=S(n[3*b],n[3*b+1],n[3*b+2]),m=W(q(q(p,h),j),v),O=0;O<3;++O)f[b][d][3*b+O]+=m[O];for(var g=b+1;g<i.bots.length;++g)if(!(I(A(i.bots[g].pos,i.bots[b].pos))>K+Q/2))for(var x=at(i.bots[b])(d)(i.bots[b],i.bots[g]),w=W(x,A(S(n[3*g],n[3*g+1],n[3*g+2]),v)),y=0;y<3;++y)f[b][d][3*b+y]+=w[y],f[b][d][3*g+y]-=w[y],f[g][d][3*g+y]+=w[y],f[g][d][3*b+y]-=w[y]}for(var C=0;C<i.bots.length;++C)for(var k=0;k<3;++k){var B=f[C][k];s[C][k]=-T(n,B)+(-t[3*C+k]+2*n[3*C+k]-e[3*C+k])/Math.pow(u,2)*2}for(var V=0;V<i.bots.length;++V)if(!(i.bots[V].pos[1]>.5)){var D=i.bots[V].pos[1]+.5;s[V][1]+=2*(D-2)*2e3}for(var F=0;F<i.bots.length;++F)for(var G=F+1;G<i.bots.length;++G){var P=A(i.bots[G].pos,i.bots[F].pos),R=I(P);R>1||(P=E(P,2*(R-2)/R*1e3),s[F]=A(s[F],P),s[G]=M(s[G],P))}for(var z=0;z<i.bots.length;++z){var J=E(r.bots[z].pos,2),H=E(o.bots[z].pos,-8),L=E(i.bots[z].pos,12),U=E(a.bots[z].pos,-8),X=E(c.bots[z].pos,2),Y=M(M(M(M(J,H),L),U),X);s[z]=M(s[z],E(Y,1e5/Math.pow(u,4)))}return s}}},lt=function(t,n){var e=X();return e.bots=t.bots.map((function(t,e){return R(t,n.bots[e])})),e},dt=function(t,n){for(var e=t.map((function(t){return t.bots.map((function(){return S(0,0,0)}))})),r=function(r){var o=(1+r*t.length/500)*t.length/10;Z(2/o);var a=function(t,n){for(var e=Object(l.a)(Array(t.length)).map((function(){return Object(l.a)(Array(t[0].bots.length)).map((function(){return S(0,0,0)}))})),r=Object(l.a)(Array(t.length)).map((function(){return Object(l.a)(Array(3*t[0].bots.length)).map((function(){return 0}))})),o=0;o<t.length;++o){var a=t[Math.max(o-1,0)],c=t[Math.min(o+1,t.length-1)];r[o]=it(a,c,n)(t[o])}for(var u=1;u<t.length-1;++u){var i=t[Math.max(u-2,0)],s=t[u-1],f=t[u+1],b=t[Math.min(u+2,t.length-1)];e[u]=bt(r[u-1],r[u],r[u+1])(i,s,f,b,n)(t[u])}return e}(t,n).map((function(t){return t.map((function(t){return E(t,-.02/(1e-4+I(t)))}))}));t.map((function(t,n){return t.bots.map((function(t,r){t.fixed||(e[n][r]=M(e[n][r],a[n][r]),e[n][r]=E(e[n][r],.9),t.pos=M(t.pos,e[n][r]))}))}))},o=0;o<500/t.length;++o)r(o)},pt=function(t){for(var n=Object(l.a)(Array(2*t.length-1)),e=0;e<t.length;++e)n[2*e]=t[e];for(var r=1;r<n.length-1;r+=2)n[r]=lt(n[r-1],n[r+1]);return n},ht=function(t,n,e){for(var r=[t,n],o=100,a=0;a<e;++a)o/=2,r=pt(r),dt(r,o);return r},jt=e(28),vt=function(){var t=new p.n;t.add(new p.a(16777215,.4));var n=new p.e(16777215,.4);return n.position.set(0,1,0),t.add(n),t},mt=function(t,n,e){return function(r){var o=new p.h;o.lookAt(Object(jt.a)(p.s,Object(l.a)(t)),Object(jt.a)(p.s,Object(l.a)(n)),(new p.k).up),o.multiply((new p.h).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1)),r.setRotationFromMatrix(o),r.scale.set(e,I(A(n,t)),e);var a=C(M(t,n),2);return r.position.set(a[0],a[1],a[2]),r}},Ot=function(t,n,e,r){var o=new p.d(1,1,1,8,1),a=new p.i(o,new p.j({color:r}));return mt(t,n,e)(a)},gt=e(30),xt=[{title:"Towers",data:[[[2,.5,0],[2,1.5,0],[2,2.5,0],[2,3.5,0],[2,4.5,0],[-2,.5,0],[-2,1.5,0],[-2,2.5,0],[-2,3.5,0],[-2,4.5,0],[2,5.5,0]],[[2,.5,0],[2,1.5,0],[2,2.5,0],[2,3.5,0],[2,4.5,0],[-2,.5,0],[-2,1.5,0],[-2,2.5,0],[-2,3.5,0],[-2,4.5,0],[-2,5.5,0]]]},{title:"Stack",data:[[[0,.5,0],[0,1.5,0],[0,2.5,0],[0,3.5,0],[0,4.5,0]],[[0,.5,0],[1,.5,0],[2,.5,0],[3,.5,0],[4,.5,0]]]},{title:"Cube",data:[[[-.5,.5,-.5],[.5,.5,-.5],[.5,.5,.5],[-.5,.5,.5],[-.5,1.5,-.5],[.5,1.5,-.5],[.5,1.5,.5],[-.5,1.5,.5],[-.5,2.5,-.5],[.5,2.5,-.5],[.5,2.5,.5],[-.5,2.5,.5],[-.5,3.5,-.5],[.5,3.5,-.5],[.5,3.5,.5],[-.5,3.5,.5]],[[-1.5,.5,-1.5],[-.5,.5,-1.5],[.5,.5,-1.5],[1.5,.5,-1.5],[-1.5,.5,-.5],[-.5,.5,-.5],[.5,.5,-.5],[1.5,.5,-.5],[-1.5,.5,.5],[-.5,.5,.5],[.5,.5,.5],[1.5,.5,.5],[-1.5,.5,1.5],[-.5,.5,1.5],[.5,.5,1.5],[1.5,.5,1.5]]]},{title:"Big cube",data:[Object(l.a)(Array(8)).map((function(t,n){return Object(l.a)(Array(8)).map((function(t,e){return[n-3.5,.5,e-3.5]}))})).flat(),Object(l.a)(Array(4)).map((function(t,n){return Object(l.a)(Array(4)).map((function(t,e){return Object(l.a)(Array(4)).map((function(t,r){return[n-1.5,r+.5,e-1.5]}))}))})).flat().flat()]}],wt=function(t,n){return a.setBots(xt[t].data[n].map((function(t){return o.setPos(r.newVec3(t[0],t[1],t[2]))(o.newBot())})))(a.newWorld())},St=new gt.a(123),yt=Object(j.a)((function(t){return{gridItem:{padding:t.spacing(2),textAlign:"center"}}})),Mt=function(){var t=Object(w.a)(),n=Object(d.a)(t,2),e=n[0],o=n[1],s=.55*e,f=.9*o,b=yt(),j=Object(i.useRef)(null),S=Object(i.useState)(),y=Object(d.a)(S,2),M=y[0],A=y[1],E=Object(i.useState)(),C=Object(d.a)(E,2),k=C[0],I=C[1],B=Object(i.useState)(),V=Object(d.a)(B,2),q=V[0],N=V[1],W=Object(i.useState)(0),D=Object(d.a)(W,2),F=D[0],G=D[1],P=Object(i.useState)(0),R=Object(d.a)(P,2),T=R[0],z=R[1],J=Object(i.useState)(!1),H=Object(d.a)(J,2),L=H[0],U=H[1],X=Object(i.useState)(vt()),Y=Object(d.a)(X,2),K=Y[0],Q=Y[1],Z=Object(i.useState)([]),$=Object(d.a)(Z,2),_=$[0],tt=$[1],nt=Object(i.useState)([]),et=Object(d.a)(nt,2),rt=et[0],ot=et[1],at=Object(i.useState)([]),ct=Object(d.a)(at,2),ut=ct[0],it=ct[1],st=Object(i.useState)([]),ft=Object(d.a)(st,2),bt=ft[0],lt=ft[1],dt=Object(i.useState)(a.newWorld()),pt=Object(d.a)(dt,2),ht=pt[0],jt=pt[1],gt=Object(i.useState)(a.newWorld()),Mt=Object(d.a)(gt,2),At=Mt[0],Et=Mt[1],Ct=Object(i.useState)(void 0),kt=Object(d.a)(Ct,2),It=kt[0],Bt=kt[1],Vt=function(t){bt[t].bots.map((function(t,n){var e;(e=_[n].position).set.apply(e,Object(l.a)(t.pos))})),bt[t].bots.map((function(t,n){K.remove(rt[n]);var e=a.edgeStrength(t.pos[1]+.5);e<.01||(K.add(rt[n]),mt(t.pos,r.newVec3(t.pos[0],0,t.pos[2]),.3*Math.sqrt(e))(rt[n]))})),bt[t].bots.map((function(n,e){return bt[t].bots.map((function(t,o){if(!(e>=o)){K.remove(ut[e][o]);var c=a.edgeStrength(r.length(r.sub(t.pos,n.pos)));c<.01||(K.add(ut[e][o]),mt(n.pos,t.pos,.3*Math.sqrt(c))(ut[e][o]))}}))}))};return Object(i.useEffect)((function(){0!==bt.length&&(tt(bt[0].bots.map((function(t){return function(t,n){var e,r=new p.o(1,16,16);r.computeVertexNormals(),r.faces.forEach((function(t){return t.vertexColors=new Array(3).fill(!0).map((function(){return n}))}));var o=(new p.b).fromGeometry(r);delete o.attributes.uv;var a=new p.i(o,new p.j({color:n}));return a.geometry=o,(e=a.position).set.apply(e,Object(l.a)(t)),a.scale.set(.5,.5,.5),a}(t.pos,t.fixed?new p.c(0,0,1):new p.c(0,1,0))}))),ot(bt[0].bots.map((function(t){return Ot(t.pos,r.newVec3(t.pos[0],0,t.pos[2]),1,new p.c(1,0,0))}))),it(bt[0].bots.map((function(t){return bt[0].bots.map((function(n){return Ot(t.pos,n.pos,1,new p.c(1,0,0))}))}))))}),[bt]),Object(i.useEffect)((function(){var t=vt();_.map((function(n){return t.add(n)})),rt.map((function(n){return t.add(n)})),ut.map((function(n,e){return n.map((function(n,r){e>=r||t.add(n)}))})),Q(t)}),[_,rt,ut]),Object(i.useEffect)((function(){var t=j.current;if(t){var n=new p.l(75,s/f,.1,1e3);n.position.set(10,10,10),n.lookAt(0,0,0),I(n);var e=new p.t({antialias:!0});e.setClearColor("#000000"),e.setSize(s,f),t.appendChild(e.domElement),N(e);var r=new h.a(n,e.domElement);r.enableDamping=!0,r.dampingFactor=.5,A(r);var o=window.setInterval((function(){return G((function(t){return t+1}))}),1e3/30);return function(){window.clearInterval(o),t.removeChild(e.domElement)}}}),[j,s,f]),Object(i.useEffect)((function(){M&&M.update(),q&&k&&K&&q.render(K,k)}),[M,q,k,F,K]),Object(i.useEffect)((function(){if(0!==_.length){var t=Math.round(.1*bt.length),n=T%(2*(bt.length+t));n<t?Vt(0):(n-=t)<bt.length?Vt(n):(n-=bt.length)<t?Vt(bt.length-1):(n-=t,Vt(bt.length-1-n))}}),[T,K]),Object(i.useEffect)((function(){if(L){var t=setInterval((function(){return z((function(t){return t+1}))}),10);return function(){return clearInterval(t)}}}),[L]),Object(u.jsx)(u.Fragment,{children:Object(u.jsxs)(v.a,{container:!0,item:!0,xs:11,children:[Object(u.jsx)(v.a,{item:!0,xs:4,style:{height:.9*window.innerHeight,overflowX:"hidden",overflowY:"scroll"},children:Object(u.jsxs)(v.a,{container:!0,direction:"column",children:[Object(u.jsx)("b",{children:"Microbots"}),Object(u.jsx)(v.a,{item:!0,className:b.gridItem,children:Object(u.jsx)(m.a,{children:Object(u.jsxs)(O.a,{children:[Object(u.jsx)(g.a,{children:Object(u.jsx)("b",{children:"Select an example"})}),Object(u.jsx)(g.a,{children:xt.map((function(t,n){return Object(u.jsx)(x.a,{variant:"contained",color:It===n?"primary":"default",onClick:function(){var t,e=[wt(t=n,0),wt(t,1)],o=Object(d.a)(e,2),a=o[0],c=o[1],u=function(){return r.multiplyScalar(r.newVec3(St.next()-.5,St.next()-.5,St.next()-.5),1e-4)};a.bots.map((function(t){return t.pos=r.add(t.pos,u())})),c.bots.map((function(t){return t.pos=r.add(t.pos,u())})),jt(a),Et(c),lt([a,c]),U(!1),Bt(n)},children:t.title},n)}))})]})})}),Object(u.jsx)(v.a,{item:!0,className:b.gridItem,children:Object(u.jsx)(m.a,{children:Object(u.jsxs)(O.a,{children:[Object(u.jsx)(g.a,{children:Object(u.jsx)("b",{children:"Compute the animation"})}),Object(u.jsx)(g.a,{children:Object(u.jsx)(x.a,{variant:"contained",onClick:function(){lt(c.createAnimation(ht,At,8)),U(!0)},children:"Generate animation"})})]})})}),Object(u.jsx)(v.a,{item:!0,className:b.gridItem,children:Object(u.jsx)(m.a,{children:Object(u.jsxs)(O.a,{children:[Object(u.jsx)(g.a,{children:Object(u.jsx)("b",{children:"Extra options"})}),Object(u.jsx)(g.a,{children:Object(u.jsxs)(x.a,{variant:"contained",onClick:function(){return z(T+1)},children:["Time: ",T]})}),Object(u.jsx)(g.a,{children:Object(u.jsxs)(x.a,{variant:"contained",onClick:function(){return U(!L)},children:["Animate: ",L?"true":"false"]})}),Object(u.jsx)(g.a,{children:Object(u.jsx)(x.a,{variant:"contained",onClick:function(){return function(){var t=document.getElementsByTagName("canvas")[0].toDataURL("image/png"),n=document.createElement("a");n.href=t.replace(/^data:image\/[^;]/,"data:application/octet-stream"),n.download="image.png",n.click()}()},children:"Save screenshot"})})]})})})]})}),Object(u.jsx)(v.a,{item:!0,xs:5,children:Object(u.jsx)("div",{ref:j})})]})})};b.a.render(Object(u.jsx)(s.a.StrictMode,{children:Object(u.jsx)(Mt,{})}),document.getElementById("root"))}},[[48,1,2]]]);
//# sourceMappingURL=main.47507446.chunk.js.map